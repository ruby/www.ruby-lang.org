{% comment %}
  News and Security section for homepage
  Displays latest news and security posts side by side
{% endcomment %}

{% comment %}Load locale data{% endcomment %}
{% if site.data.locales[page.lang].news %}
  {% assign news_locale = site.data.locales[page.lang].news %}
{% else %}
  {% assign news_locale = site.data.locales['en'].news %}
{% endif %}

{% comment %}Get latest news and security posts{% endcomment %}
{% assign news_posts = '' | split: '' %}
{% assign security_posts = '' | split: '' %}

{% for post in site.categories[page.lang] %}
  {% if post.tags contains 'security' %}
    {% if security_posts.size < 6 %}
      {% assign security_posts = security_posts | push: post %}
    {% endif %}
  {% else %}
    {% if news_posts.size < 4 %}
      {% assign news_posts = news_posts | push: post %}
    {% endif %}
  {% endif %}
  {% if news_posts.size >= 4 and security_posts.size >= 6 %}
    {% break %}
  {% endif %}
{% endfor %}

<section class="bg-stone-50 dark:bg-stone-900">
  <div class="container mx-auto px-4 md:px-6 lg:px-8 py-12 lg:py-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">

      {% comment %}News Section (2/3 width){% endcomment %}
      <div class="lg:col-span-2">
        <h2 class="text-4xl font-bold text-stone-900 dark:text-stone-100 mb-8 flex items-center gap-2">
          News
          <a href="/{{ page.lang }}/news/" class="text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered dark:hover:text-ruby-400 transition-colors">
            <span class="icon-chevron-right text-3xl" aria-hidden="true"></span>
          </a>
        </h2>

        <div class="space-y-6">
          {% for post in news_posts %}
          <article class="pb-6 {% unless forloop.last %}border-b border-dashed border-stone-300 dark:border-stone-700{% endunless %}">
            <time datetime="{{ post.date | date_to_xmlschema }}" class="text-sm font-semibold text-amber-600 dark:text-amber-500">
              {{ post.date | date: "%b %-d, %Y" }}
            </time>

            <h3 class="text-xl font-bold text-stone-900 dark:text-stone-100 mt-2 mb-3">
              <a href="{{ post.url }}" class="hover:text-semantic-text-link-hovered dark:hover:text-ruby-400 transition-colors">
                {{ post.title }}
              </a>
            </h3>

            <div class="text-sm text-stone-600 dark:text-stone-400 line-clamp-2">
              {{ post.excerpt | strip_html | truncatewords: 30 }}
            </div>
          </article>
          {% endfor %}
        </div>
      </div>

      {% comment %}Security Section (1/3 width){% endcomment %}
      <div>
        <h2 class="text-4xl font-bold text-stone-900 dark:text-stone-100 mb-8 flex items-center gap-2">
          Security
          <a href="/{{ page.lang }}/security/" class="text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered dark:hover:text-ruby-400 transition-colors">
            <span class="icon-chevron-right text-3xl" aria-hidden="true"></span>
          </a>
        </h2>

        <div class="space-y-6">
          {% for post in security_posts %}
          <article class="pb-6 {% unless forloop.last %}border-b border-dashed border-stone-300 dark:border-stone-700{% endunless %}">
            <time datetime="{{ post.date | date_to_xmlschema }}" class="text-sm font-semibold text-amber-600 dark:text-amber-500">
              {{ post.date | date: "%b %-d, %Y" }}
            </time>

            <h3 class="text-base font-bold text-stone-900 dark:text-stone-100 mt-2">
              <a href="{{ post.url }}" class="hover:text-semantic-text-link-hovered dark:hover:text-ruby-400 transition-colors">
                {{ post.title }}
              </a>
            </h3>
          </article>
          {% endfor %}

          <p class="pt-2">
            <a href="/{{ page.lang }}/security/" class="text-sm font-semibold text-amber-600 dark:text-amber-500 hover:text-amber-700 dark:hover:text-amber-400 transition-colors inline-flex items-center gap-1">
              more
              <span class="icon-chevron-right text-xs" aria-hidden="true"></span>
            </a>
          </p>
        </div>
      </div>

    </div>
  </div>
</section>
