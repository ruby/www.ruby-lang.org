{% if site.data.locales[page.lang].news %}
  {% assign locales = site.data.locales[page.lang].news %}
{% else %}
  {% assign locales = site.data.locales['en'].news %}
{% endif %}

{% if site.data.locales[page.lang].sidebar %}
  {% assign syndicate = site.data.locales[page.lang].sidebar.syndicate %}
{% else %}
  {% assign syndicate = site.data.locales['en'].sidebar.syndicate %}
{% endif %}

{% if site.data.locales[page.lang].sitelinks %}
  {% assign sitelinks = site.data.locales[page.lang].sitelinks %}
{% else %}
  {% assign sitelinks = site.data.locales['en'].sitelinks %}
{% endif %}

{% comment %}Find news and security links from sitelinks{% endcomment %}
{% assign news_link = nil %}
{% assign security_link = nil %}
{% for link in sitelinks %}
  {% if link.url contains '/news' %}
    {% assign news_link = link %}
  {% elsif link.url contains '/security' %}
    {% assign security_link = link %}
  {% endif %}
{% endfor %}

<div class="bg-stone-50 dark:bg-stone-800 rounded-lg border border-stone-200 dark:border-stone-700 lg:bg-transparent lg:dark:bg-transparent lg:border-0 lg:rounded-none p-4 pb-6 lg:p-0">
  <!-- Top Navigation Section -->
  <div class="pb-6 mb-6">
    <h3 class="text-xs font-semibold text-stone-500 dark:text-stone-400 mb-1 border-b border-stone-200 dark:border-stone-700 pb-3">{{ news_link.text }}</h3>
    <nav class="space-y-0">
      {% if news_link %}
      <div class="border-b border-stone-200 dark:border-stone-700">
        <a href="{{ news_link.url }}"
           class="flex items-center justify-between py-3 pl-1 text-sm group {% if page.url contains '/news' %}text-semantic-text-link font-bold{% else %}text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered font-bold{% endif %} transition-colors">
          <span>{{ news_link.text }}</span>
          <svg class="w-3 h-3 text-stone-400 dark:text-stone-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {% endif %}
      {% if security_link %}
      <div class="border-b border-stone-200 dark:border-stone-700">
        <a href="{{ security_link.url }}"
           class="flex items-center justify-between py-3 pl-1 text-sm group {% if page.url contains '/security' %}text-semantic-text-link font-bold{% else %}text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered font-bold{% endif %} transition-colors">
          <span>{{ security_link.text }}</span>
          <svg class="w-3 h-3 text-stone-400 dark:text-stone-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
      {% endif %}
    </nav>
  </div>

  <!-- Yearly Archives Section (only for news pages) -->
  {% if page.url contains '/news' %}
  <div class="pb-8 border-b border-stone-200 dark:border-stone-700">
    <h3 class="text-sm font-bold text-stone-900 dark:text-stone-100 mb-4 pl-1 flex items-center gap-2">
      <span class="icon-calendar" aria-hidden="true"></span>
      {{ locales.yearly_archives }}
    </h3>
    <div class="relative group">
      <button class="flex items-center justify-between w-full px-4 py-2 text-sm border border-stone-300 dark:border-stone-600 rounded-lg hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors">
        <span class="text-stone-700 dark:text-stone-300">{{ locales.select_year }}</span>
        <span class="icon-dropdown text-base" aria-hidden="true"></span>
      </button>

      <!-- Archive year dropdown -->
      <div class="absolute left-0 mt-1 w-full max-h-96 overflow-y-auto bg-white dark:bg-stone-800 rounded-lg shadow-lg border border-stone-200 dark:border-stone-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
        <div class="py-2">
          {% for year in page.years %}
          <a href="{{ year[0] }}/" class="block px-4 py-2 text-sm text-stone-700 dark:text-stone-300 hover:bg-stone-100 dark:hover:bg-stone-700 transition-colors">
            {{ year[1] }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Syndicate Section -->
  <div class="pt-6">
    <p class="pl-1">
      <a href="{{ syndicate.recent_news.url }}" target="_blank" rel="noopener noreferrer" class="text-sm font-normal text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered transition-colors inline-flex items-center gap-1">
        <span class="icon-rss-feed" aria-hidden="true"></span>
        {{ syndicate.recent_news.text }}<span class="icon-external text-xs" aria-hidden="true"></span>
      </a>
    </p>
  </div>
</div>
