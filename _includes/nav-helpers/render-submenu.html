{% comment %}
  Helper to render submenu items recursively
  Parameters: subitem
{% endcomment %}

{% if include.subitem.submenu %}
  {% comment %}Item with nested submenu{% endcomment %}

  {% if include.subitem.url %}
    {% comment %}Parent has URL - render as link with nested items{% endcomment %}
    {% include nav-helpers/check-active.html item_url=include.subitem.url item_external=include.subitem.external %}

    <div class="border-b border-stone-200 dark:border-stone-700">
      <a href="{{ include.subitem.url }}"
         class="flex items-center justify-between py-4 pl-1 text-base group {% if is_active %}text-semantic-text-link font-bold{% else %}text-stone-900 dark:text-stone-100 hover:text-semantic-text-link-hovered font-bold{% endif %} transition-colors"
         {% if include.subitem.external %}target="_blank" rel="noopener noreferrer"{% endif %}>
        <span class="{% if include.subitem.external %}inline-flex items-center gap-1{% endif %}">
          {{ include.subitem.text }}
          {% if include.subitem.external %}<span class="icon-external text-xs" aria-hidden="true"></span>{% endif %}
        </span>
        <svg class="w-3 h-3 text-stone-400 dark:text-stone-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </a>

      <ul class="space-y-2 list-disc pl-5 pb-6 marker:text-stone-400 dark:marker:text-stone-500">
        {% for nesteditem in include.subitem.submenu %}
          {% include nav-helpers/check-active.html item_url=nesteditem.url item_external=nesteditem.external %}
          {% include nav-helpers/render-link.html url=nesteditem.url text=nesteditem.text external=nesteditem.external is_active=is_active is_nested=true %}
        {% endfor %}
      </ul>
    </div>

  {% else %}
    {% comment %}Parent has no URL - render as section header{% endcomment %}
    <div class="{% if include.is_first %}pt-0 mt-0{% else %}pt-6 mt-6{% endif %} border-b border-stone-200 dark:border-stone-700 pb-6">
      <h4 class="text-xs font-semibold text-stone-500 dark:text-stone-400 mb-4 pl-1">{{ include.subitem.text }}</h4>
      <ul class="space-y-2 list-disc pl-5 marker:text-stone-400 dark:marker:text-stone-500">
        {% for nesteditem in include.subitem.submenu %}
          {% include nav-helpers/check-active.html item_url=nesteditem.url item_external=nesteditem.external %}
          {% include nav-helpers/render-link.html url=nesteditem.url text=nesteditem.text external=nesteditem.external is_active=is_active is_nested=true %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}

{% else %}
  {% comment %}Regular submenu item (no nesting){% endcomment %}
  {% include nav-helpers/check-active.html item_url=include.subitem.url item_external=include.subitem.external %}
  {% include nav-helpers/render-link.html url=include.subitem.url text=include.subitem.text external=include.subitem.external is_active=is_active is_nested=false %}
{% endif %}
